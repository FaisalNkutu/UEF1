(()=>{"use strict";var e={8371:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ee,navigationRef:()=>Y});var o=r(6665),n=r(6520),a=r(5393),s=r(8179),l=r(3929),i=r(6283),d=r(6773),c=r(2772),u=r(8180),f=r(3668),g=r(7851),h=r.n(g),m=r(7366),p=r(397);function x({route:e,navigation:t,onLogout:r}){const n=e?.params?.user??null,a=n?.id??null,s=n?.role?.toLowerCase()??"unknown",[f,g]=(0,o.useState)([]),[x,j]=(0,o.useState)({}),[y,S]=(0,o.useState)(""),[w,v]=(0,o.useState)(0);(0,o.useEffect)((()=>{a||window.alert("\u26a0\ufe0f Warning: userId is missing!")}),[]),(0,o.useEffect)((()=>{fetch("http://192.168.91.1:8085/api/feedback/questions").then((e=>e.json())).then((e=>{Array.isArray(e.content)?g(e.content):S("Invalid format from server")})).catch((()=>{S("Failed to load questions")}))}),[]);const C=(e,t)=>{j((r=>Object.assign({},r,{[e]:t})))},T=(e,t)=>{window.alert(`${e}\n\n${t}`)},k=f[w];return(0,p.jsxs)(l.default,{style:{flex:1},children:[(0,p.jsxs)(c.default,{contentContainerStyle:b.container,children:[(0,p.jsxs)(i.default,{style:b.title,children:["Survey Question ",w+1," of ",f.length]}),(0,p.jsxs)(i.default,{style:b.subText,children:["\ud83d\udc64 Role: ",s," | \ud83c\udd94 ID: ",a??"N/A"]}),""!==y&&(0,p.jsx)(i.default,{style:b.error,children:y}),k&&(0,p.jsxs)(l.default,{style:b.questionBlock,children:[(0,p.jsx)(i.default,{style:b.label,children:k.questiontext}),"text"===k.questiontype&&(0,p.jsx)(d.default,{style:b.input,value:x[k.id]||"",placeholder:"Type your answer",onChangeText:e=>C(k.id,e)}),"multichoice"===k.questiontype&&(0,p.jsx)(l.default,{style:b.input,children:(0,p.jsxs)(m.Picker,{selectedValue:x[k.id]||"",onValueChange:e=>C(k.id,e),children:[(0,p.jsx)(m.Picker.Item,{label:"Select an option",value:""}),k.presentation.split("|").map((e=>(0,p.jsx)(m.Picker.Item,{label:e,value:e},e)))]})}),"numeric"===k.questiontype&&(()=>{const e=k.presentation.split("|").map(Number).sort(((e,t)=>e-t)),t=e[0],r=e[e.length-1],o=e.length>1?e[1]-e[0]:1,n=x[k.id]?Number(x[k.id]):t;return(0,p.jsxs)(l.default,{style:b.sliderBlock,children:[(0,p.jsxs)(i.default,{style:b.sliderValue,children:["Selected: ",n]}),(0,p.jsx)(h(),{minimumValue:t,maximumValue:r,step:o,value:n,onValueChange:e=>C(k.id,e.toString()),minimumTrackTintColor:"#006bae",maximumTrackTintColor:"#ccc",thumbTintColor:"#006bae"}),(0,p.jsxs)(l.default,{style:b.sliderLabels,children:[(0,p.jsx)(i.default,{children:t}),(0,p.jsx)(i.default,{children:r})]})]})})()]},k.id),(0,p.jsxs)(l.default,{style:b.paginationRow,children:[(0,p.jsx)(l.default,{style:b.halfButton,children:(0,p.jsx)(u.default,{title:"Previous",onPress:()=>v((e=>Math.max(e-1,0))),disabled:0===w})}),(0,p.jsx)(l.default,{style:b.halfButton,children:(0,p.jsx)(u.default,{title:w===f.length-1?"Submit":"Next",onPress:()=>{const e=x[k?.id];e&&""!==e.toString().trim()?w===f.length-1?(async()=>{if(!a)return void T("Error","Cannot submit, userId is missing.");const e=f.map((e=>({questionId:e.id,answer:x[e.id]?.toString().trim()||""}))).filter((e=>""!==e.answer));if(e.length<f.length)T("Please answer all questions.","");else try{const t=await fetch(`http://192.168.91.1:8085/api/feedback/submit?userId=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.text();t.ok?T("\u2705 Submitted successfully!",r):T(`\u274c Server error (${t.status})`,r)}catch(t){T("\u274c Network error",t.message)}})():v((e=>e+1)):T("Please answer this question before continuing.","")},disabled:0===f.length})})]}),(0,p.jsx)(l.default,{style:b.buttonRow,children:(0,p.jsx)(u.default,{title:"View My Responses",onPress:()=>{a?t.navigate("SurveyDashboard",{user:n}):T("Error","Cannot navigate, userId is missing.")},color:"#444"})})]}),(0,p.jsx)(l.default,{style:b.logoutWrapper,children:(0,p.jsx)(u.default,{title:"Logout",color:"#006bae",onPress:()=>{r&&r(),t.dispatch(CommonActions.reset({index:0,routes:[{name:"Login"}]}))}})})]})}const b=f.default.create({container:{padding:20,paddingBottom:100,backgroundColor:"#f5f5f5"},title:{fontSize:22,color:"#006bae",textAlign:"center",marginBottom:10},subText:{fontSize:14,textAlign:"center",color:"#666",marginBottom:15},questionBlock:{marginBottom:20},label:{fontWeight:"bold",marginBottom:5},input:{borderWidth:1,borderColor:"#ccc",borderRadius:4,paddingHorizontal:10,paddingVertical:8,backgroundColor:"#fff"},error:{color:"red",marginBottom:15,textAlign:"center"},sliderBlock:{marginTop:10,paddingVertical:10},sliderValue:{marginBottom:5,fontWeight:"600",color:"#333"},sliderLabels:{flexDirection:"row",justifyContent:"space-between",marginTop:5},buttonRow:{marginTop:30},paginationRow:{flexDirection:"row",justifyContent:"space-between",marginTop:20},halfButton:{flex:1,marginHorizontal:5},logoutWrapper:{position:"absolute",bottom:0,left:0,right:0,backgroundColor:"#fff",padding:10,borderTopWidth:1,borderColor:"#ddd"}});var j=r(1690),y=r(5648);function S({navigation:e,onLogout:t}){const[r,n]=(0,o.useState)(""),[a,f]=(0,o.useState)("text"),[g,h]=(0,o.useState)("");return(0,p.jsxs)(l.default,{style:{flex:1},children:[(0,p.jsxs)(c.default,{contentContainerStyle:w.container,children:[(0,p.jsx)(i.default,{style:w.title,children:"Create New Survey Question"}),(0,p.jsx)(i.default,{style:w.label,children:"Question Text:"}),(0,p.jsx)(d.default,{style:w.input,value:r,onChangeText:n,placeholder:"Enter question here"}),(0,p.jsx)(i.default,{style:w.label,children:"Question Type:"}),(0,p.jsx)(l.default,{style:w.input,children:(0,p.jsxs)(m.Picker,{selectedValue:a,onValueChange:e=>f(e),children:[(0,p.jsx)(m.Picker.Item,{label:"Text",value:"text"}),(0,p.jsx)(m.Picker.Item,{label:"Multichoice",value:"multichoice"}),(0,p.jsx)(m.Picker.Item,{label:"Numeric (Rating)",value:"numeric"})]})}),(0,p.jsx)(i.default,{style:w.label,children:"Presentation (use `|` to separate multichoice options):"}),(0,p.jsx)(d.default,{style:w.input,value:g,onChangeText:h,placeholder:"Option1|Option2|Option3"}),(0,p.jsxs)(l.default,{style:{flexDirection:"row",justifyContent:"space-between"},children:[(0,p.jsx)(l.default,{style:w.buttonWrapper,children:(0,p.jsx)(u.default,{title:"Save Question",onPress:async()=>{if(r.trim())try{(await fetch("http://192.168.91.1:8085/saveQuestion",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`questiontext=${encodeURIComponent(r)}&questiontype=${encodeURIComponent(a)}&presentation=${encodeURIComponent(g)}`})).ok?(j.default.alert("\u2705 Success","Question saved!"),n(""),h(""),f("text")):j.default.alert("Error","Failed to save question")}catch(e){console.error(e),j.default.alert("Error","Network error")}else j.default.alert("Validation Error","Question Text is required")},color:"#006bae"})}),(0,p.jsx)(y.default,{style:w.buttonWrapper,children:(0,p.jsx)(u.default,{title:"View Survey Responses",onPress:()=>e.navigate("SurveyDashboard"),color:"#006bae"})})]})]}),(0,p.jsx)(l.default,{style:w.logoutWrapper,children:(0,p.jsx)(y.default,{style:w.buttonWrapper,children:(0,p.jsx)(u.default,{title:"Logout",color:"#006bae",onPress:()=>{t&&t(),e.dispatch(s.CommonActions.reset({index:0,routes:[{name:"Login"}]}))}})})})]})}const w=f.default.create({container:{padding:20,backgroundColor:"#f5f5f5",flexGrow:1,paddingBottom:100},title:{fontSize:22,color:"#006bae",textAlign:"center",marginBottom:20,fontWeight:"bold"},label:{fontWeight:"bold",marginTop:10,marginBottom:5},input:{borderWidth:1,borderColor:"#ccc",borderRadius:4,padding:8,backgroundColor:"#fff"},buttonWrapper:{marginTop:20,alignItems:"center"},logoutWrapper:{position:"absolute",bottom:0,left:0,right:0,backgroundColor:"#fff",padding:10,borderTopWidth:1,borderColor:"#ddd"}});var v=r(530),C=r(932);function T({route:e,navigation:t}){const{user:r}=e.params,[n,a]=(0,o.useState)([]),[s,u]=(0,o.useState)("STUDENT"===r.role?r.id:null),[f,g]=(0,o.useState)(""),[h,m]=(0,o.useState)([]),[x,b]=(0,o.useState)([]),[S,w]=(0,o.useState)(!1),T=async e=>{try{w(!0);const t=await fetch(`http://192.168.91.1:8085/api/feedback/responses/${e}`),r=await t.json();b(r)}catch(t){j.default.alert("Error","Failed to fetch responses")}finally{w(!1)}};(0,o.useEffect)((()=>{"TEACHER"===r.role&&(async()=>{try{const e=await fetch("http://192.168.91.1:8085/api/feedback/users"),t=await e.json();a(t),m(t)}catch(e){j.default.alert("Error","Could not fetch user list")}})(),"STUDENT"===r.role&&T(r.id)}),[]);return(0,p.jsxs)(c.default,{contentContainerStyle:k.container,children:[(0,p.jsx)(i.default,{style:k.title,children:"Submitted Survey Responses"}),(0,p.jsx)(y.default,{onPress:()=>t.navigate("ViewResponses",{user:r}),children:(0,p.jsx)(i.default,{style:k.menuItem,children:"\ud83d\udcca View Responses"})}),"TEACHER"===r.role&&(0,p.jsxs)(l.default,{style:k.dropdown,children:[(0,p.jsx)(d.default,{style:k.input,placeholder:"Search student by username",value:f,onChangeText:e=>{g(e),m(n.filter((t=>t.username.toLowerCase().includes(e.toLowerCase()))))}}),f.length>0&&(0,p.jsx)(C.default,{data:h,keyExtractor:e=>e.id.toString(),renderItem:({item:e})=>(0,p.jsx)(y.default,{onPress:()=>{return t=e.id,u(t),T(t),g(""),void m([]);var t},children:(0,p.jsx)(i.default,{style:k.option,children:e.username})}),style:k.dropdownList})]}),S?(0,p.jsx)(v.default,{size:"large",color:"#006bae"}):(0,p.jsx)(p.Fragment,{children:0===x.length?(0,p.jsx)(i.default,{style:k.info,children:"No responses available."}):x.map(((e,t)=>(0,p.jsxs)(l.default,{style:k.responseItem,children:[(0,p.jsxs)(i.default,{style:k.qid,children:["Q",e.questionId]}),(0,p.jsx)(i.default,{style:k.answer,children:e.answer||"(no answer)"}),e.timestamp&&(0,p.jsx)(i.default,{style:k.timestamp,children:new Date(e.timestamp).toLocaleString()})]},t)))})]})}const k=f.default.create({container:{padding:20,backgroundColor:"#f5f5f5"},title:{fontSize:22,color:"#006bae",textAlign:"center",marginBottom:20},dropdown:{marginBottom:20},input:{borderColor:"#ccc",borderWidth:1,borderRadius:5,padding:10,backgroundColor:"#fff"},dropdownList:{maxHeight:200,borderColor:"#ccc",borderWidth:1,borderTopWidth:0,backgroundColor:"#fff"},option:{padding:10,borderBottomColor:"#eee",borderBottomWidth:1},info:{textAlign:"center",color:"#888",fontStyle:"italic",marginTop:10},responseItem:{backgroundColor:"#fff",padding:15,marginBottom:10,borderRadius:8,borderLeftColor:"#006bae",borderLeftWidth:5},qid:{fontWeight:"bold",marginBottom:5},answer:{fontSize:16},timestamp:{fontSize:12,color:"#777",marginTop:8,fontStyle:"italic"},menuItem:{color:"#006bae",fontWeight:"bold",textAlign:"center",marginBottom:15,fontSize:16}});var L=r(5259);function P({route:e,onLogout:t}){const r=(0,s.useNavigation)(),n=e.params?.user||{},a=n.role?.toLowerCase()||"",f=n.id,[g,h]=(0,o.useState)([]),[m,x]=(0,o.useState)(""),[b,S]=(0,o.useState)([]),[w,v]=(0,o.useState)("student"===a?f:null),[T,k]=(0,o.useState)([]),[P,I]=(0,o.useState)({key:null,direction:"asc"});(0,o.useEffect)((()=>{"student"!==a?fetch("http://192.168.91.1:8085/api/feedback/users").then((e=>e.json())).then((e=>{Array.isArray(e)?(h(e),S(e)):j.default.alert("Error","Invalid user data format from backend")})).catch((()=>j.default.alert("Error","Unable to fetch users"))):fetch(`http://192.168.91.1:8085/api/feedback/users/${f}`).then((e=>{if(!e.ok)throw new Error("User not found");return e.json()})).then((e=>{h([e]),S([e]),v(e.id),W(e.id)})).catch((()=>j.default.alert("Error","Unable to fetch user details")))}),[]);const W=async e=>{const t=e??w??1;try{const e=await fetch(`http://192.168.91.1:8085/api/feedback/responses/${t}`),r=await e.json();if(!Array.isArray(r))return void j.default.alert("Error","Invalid response format from backend");k(r)}catch{j.default.alert("Error","Failed to load responses")}},B=e=>{let t="asc";P.key===e&&"asc"===P.direction&&(t="desc");const r=[...T].sort(((r,o)=>{const n=(r[e]||"").toString().toLowerCase(),a=(o[e]||"").toString().toLowerCase();return"asc"===t?n.localeCompare(a):a.localeCompare(n)}));k(r),I({key:e,direction:t})};return(0,p.jsxs)(l.default,{style:{flex:1},children:[(0,p.jsxs)(c.default,{contentContainerStyle:R.container,children:[(0,p.jsx)(i.default,{style:R.title,children:"Dashboard"}),"student"!==a&&(0,p.jsxs)(l.default,{style:R.searchBox,children:[(0,p.jsx)(d.default,{style:R.input,placeholder:"Search Student Username",value:m,onChangeText:e=>{x(e);const t=g.filter((t=>t.username?.toLowerCase().includes(e.toLowerCase())));S(t);const r=t.find((t=>t.username?.toLowerCase()===e.toLowerCase()));v(r?r.id:null)}}),b.length>0&&(0,p.jsx)(C.default,{data:b,keyExtractor:e=>e.id?.toString()??Math.random().toString(),renderItem:({item:e})=>(0,p.jsx)(y.default,{onPress:()=>{x(e.username),v(e.id)},children:(0,p.jsx)(i.default,{style:R.option,children:e.username})}),style:R.dropdownList}),(0,p.jsx)(u.default,{title:"View Responses",onPress:()=>W(),color:"#006bae"}),(0,p.jsx)(l.default,{style:{marginTop:10}}),(0,p.jsx)(u.default,{title:"\ud83d\udcca View Usage Chart (All Users)",color:"#28a745",onPress:()=>r.navigate("UsageChart")}),(0,p.jsx)(l.default,{style:{marginTop:10}}),(0,p.jsx)(u.default,{title:"\ud83d\udcca View Usage Chart (Selected User)",color:"#1e90ff",onPress:()=>{w?r.navigate("ScreenUsageDashboard",{userId:w}):j.default.alert("Select User","Please select a user before viewing usage.")}})]}),(0,p.jsx)(i.default,{style:R.subheading,children:"Responses"}),(0,p.jsxs)(l.default,{style:R.tableHeader,children:[(0,p.jsx)(y.default,{style:R.cellHeader,onPress:()=>B("questionId"),children:(0,p.jsxs)(i.default,{style:R.sortableHeader,children:["QID ","questionId"===P.key?"asc"===P.direction?"\u2191":"\u2193":""]})}),(0,p.jsx)(y.default,{style:R.cellHeader,onPress:()=>B("answer"),children:(0,p.jsxs)(i.default,{style:R.sortableHeader,children:["Answer ","answer"===P.key?"asc"===P.direction?"\u2191":"\u2193":""]})}),(0,p.jsx)(y.default,{style:R.cellHeader,onPress:()=>B("timestamp"),children:(0,p.jsxs)(i.default,{style:R.sortableHeader,children:["Timestamp ","timestamp"===P.key?"asc"===P.direction?"\u2191":"\u2193":""]})})]}),0===T.length?(0,p.jsx)(i.default,{style:R.noResponse,children:"No responses available."}):T.map(((e,t)=>(0,p.jsxs)(l.default,{style:R.tableRow,children:[(0,p.jsx)(i.default,{style:R.cell,children:e.questionId??"\u2013"}),(0,p.jsx)(i.default,{style:R.cell,children:e.answer?.trim()||"(no answer)"}),(0,p.jsx)(i.default,{style:R.cell,children:e.timestamp||"(no time)"})]},t)))]}),(0,p.jsx)(l.default,{style:R.logoutWrapper,children:(0,p.jsx)(u.default,{title:"\ud83d\udeaa Logout",color:"#006bae",onPress:async()=>{try{await L.default.removeItem("authToken"),r.dispatch(s.CommonActions.reset({index:0,routes:[{name:"Login"}]})),"function"===typeof t&&t()}catch(e){j.default.alert("Logout Failed","An error occurred while logging out."),console.error("Logout error:",e)}}})})]})}const R=f.default.create({container:{padding:20,paddingBottom:100,backgroundColor:"#f5f5f5"},title:{fontSize:22,color:"#2c3e50",textAlign:"center",marginBottom:20},subheading:{fontSize:18,color:"#2c3e50",marginTop:20,marginBottom:10},searchBox:{marginBottom:20},input:{borderWidth:1,borderColor:"#ccc",borderRadius:4,padding:10,backgroundColor:"#fff",fontSize:16},dropdownList:{maxHeight:150,borderColor:"#ccc",borderWidth:1,backgroundColor:"#fff",marginTop:5},option:{padding:10,borderBottomColor:"#eee",borderBottomWidth:1},tableHeader:{flexDirection:"row",backgroundColor:"#d6ecff",paddingVertical:10,borderTopLeftRadius:4,borderTopRightRadius:4},tableRow:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#ddd",paddingVertical:8},cellHeader:{flex:1,textAlign:"center"},sortableHeader:{fontWeight:"bold",textAlign:"center",textDecorationLine:"underline",color:"#006bae"},cell:{flex:1,textAlign:"center"},noResponse:{textAlign:"center",fontStyle:"italic",color:"#888",marginTop:10},logoutWrapper:{position:"absolute",bottom:0,left:0,right:0,backgroundColor:"#fff",padding:10,borderTopWidth:1,borderColor:"#ddd"}});function I({navigation:e,route:t}){const{user:r}=t.params;return(0,p.jsxs)(c.default,{contentContainerStyle:W.container,children:[(0,p.jsxs)(i.default,{style:W.title,children:["Welcome, ",r.username,"!"]}),(0,p.jsxs)(l.default,{style:W.menu,children:["student"===r.role&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(y.default,{onPress:()=>e.navigate("Survey",{user:r}),children:(0,p.jsx)(i.default,{style:W.menuItem,children:"\ud83d\udcdd Take Surveymmmmm"})}),(0,p.jsx)(y.default,{onPress:()=>e.navigate("ViewResponses",{user:r}),children:(0,p.jsx)(i.default,{style:W.menuItem,children:"\ud83d\udcca View Responsesmmmm"})})]}),"student"!==r.role&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(y.default,{onPress:()=>e.navigate("CreateSurvey",{user:r}),children:(0,p.jsx)(i.default,{style:W.menuItem,children:"\u2795 Create Survey"})}),(0,p.jsx)(y.default,{onPress:()=>e.navigate("SurveyDashboard",{user:r}),children:(0,p.jsx)(i.default,{style:W.menuItem,children:"\ud83d\udccb Survey Dashboard"})}),(0,p.jsx)(y.default,{onPress:()=>e.navigate("UsageChart",{user:r}),children:(0,p.jsx)(i.default,{style:W.menuItem,children:"\ud83d\udcc8 Usage Chart"})}),(0,p.jsx)(y.default,{onPress:()=>e.navigate("ScreenUsageDashboard",{user:r}),children:(0,p.jsx)(i.default,{style:W.menuItem,children:"\ud83d\udda5\ufe0f Screen Usage Dashboard"})})]}),(0,p.jsx)(l.default,{style:W.buttonWrapper,children:(0,p.jsx)(u.default,{title:"\ud83d\udda5\ufe0f View Live Log",onPress:()=>e.navigate("LiveLog",{user:r}),color:"#006bae"})})]})]})}const W=f.default.create({container:{padding:20,backgroundColor:"#f5f5f5",flexGrow:1,justifyContent:"center"},title:{fontSize:24,fontWeight:"bold",textAlign:"center",color:"#006bae",marginBottom:30},menu:{gap:15},menuItem:{padding:12,fontSize:18,color:"#006bae",textAlign:"center",backgroundColor:"#e0f0ff",borderRadius:6},buttonWrapper:{marginTop:20,alignSelf:"center",width:"80%"}});var B=r(484);function E({navigation:e,onLogin:t}){const[r,n]=(0,o.useState)(""),[a,s]=(0,o.useState)(""),[f,g]=(0,o.useState)("");return(0,p.jsxs)(c.default,{contentContainerStyle:A.container,children:[(0,p.jsxs)(l.default,{style:A.header,children:[(0,p.jsx)(B.default,{source:{uri:"https://www.uefwebshop.fi/cdn/shop/files/UEF_eng_black.jpg?v=1693486399&width=330"},style:A.logo}),(0,p.jsx)(i.default,{style:A.title,children:"University of Eastern Finland - LMS"})]}),(0,p.jsxs)(l.default,{style:A.loginBox,children:[(0,p.jsx)(i.default,{style:A.loginTitle,children:"Login"}),(0,p.jsx)(i.default,{style:A.label,children:"Username:"}),(0,p.jsx)(d.default,{style:A.input,value:r,onChangeText:n,autoCapitalize:"none"}),(0,p.jsx)(i.default,{style:A.label,children:"Password:"}),(0,p.jsx)(d.default,{style:A.input,value:a,onChangeText:s,secureTextEntry:!0}),""!==f&&(0,p.jsx)(i.default,{style:A.error,children:f}),(0,p.jsx)(l.default,{style:A.buttonWrapper,children:(0,p.jsx)(u.default,{title:"Login",onPress:async()=>{var o,n;if(r&&a)try{const s=await fetch("http://192.168.91.1:8085/api/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`username=${encodeURIComponent(r)}&password=${encodeURIComponent(a)}`}),l=await s.json();l.role;s.ok&&l.token?(await L.default.setItem("authToken",l.token),"student"===l.role.toLowerCase()?e.navigate("Survey",{user:l}):e.navigate("CreateSurvey",{user:l}),t(l)):(o="Login failed",n=l.error||"Invalid credentials",window.alert(`${o}\n\n${n}`))}catch(s){console.error(s),g("Network error")}else g("Both fields are required")},color:"#006bae"})}),(0,p.jsx)(y.default,{onPress:()=>e.navigate("Register"),children:(0,p.jsx)(i.default,{style:A.registerLink,children:"Don't have an account? Register"})})]})]})}const A=f.default.create({container:{backgroundColor:"#f5f5f5",flexGrow:1,paddingBottom:20},header:{backgroundColor:"#006bae",padding:20,alignItems:"center"},logo:{height:60,width:120,marginBottom:10},title:{color:"#fff",fontSize:18,fontWeight:"bold"},loginBox:{backgroundColor:"#fff",margin:30,padding:20,borderRadius:10,elevation:3},loginTitle:{fontSize:22,color:"#006bae",textAlign:"center",marginBottom:20,fontWeight:"bold"},label:{marginTop:10,fontWeight:"bold"},input:{borderWidth:1,borderColor:"#ccc",paddingHorizontal:10,paddingVertical:8,borderRadius:5,marginTop:5},buttonWrapper:{marginTop:20},error:{color:"red",marginTop:10,textAlign:"center"},registerLink:{marginTop:20,textAlign:"center",color:"#006bae",textDecorationLine:"underline"}});function D({navigation:e}){const[t,r]=(0,o.useState)({firstName:"",lastName:"",email:"",password:"",role:""}),n=(e,o)=>{r(Object.assign({},t,{[e]:o}))};return(0,p.jsxs)(c.default,{style:O.container,children:[(0,p.jsxs)(l.default,{style:O.header,children:[(0,p.jsx)(B.default,{source:{uri:"https://www.uefwebshop.fi/cdn/shop/files/UEF_eng_black.jpg?v=1693486399&width=330"},style:O.logo}),(0,p.jsx)(i.default,{style:O.title,children:"University of Eastern Finland - LMS"})]}),(0,p.jsxs)(l.default,{style:O.form,children:[(0,p.jsx)(i.default,{style:O.heading,children:"Create an Account"}),(0,p.jsx)(i.default,{style:O.label,children:"First Name"}),(0,p.jsx)(d.default,{style:O.input,value:t.firstName,onChangeText:e=>n("firstName",e)}),(0,p.jsx)(i.default,{style:O.label,children:"Last Name"}),(0,p.jsx)(d.default,{style:O.input,value:t.lastName,onChangeText:e=>n("lastName",e)}),(0,p.jsx)(i.default,{style:O.label,children:"Email"}),(0,p.jsx)(d.default,{style:O.input,keyboardType:"email-address",value:t.email,onChangeText:e=>n("email",e)}),(0,p.jsx)(i.default,{style:O.label,children:"Password"}),(0,p.jsx)(d.default,{style:O.input,secureTextEntry:!0,value:t.password,onChangeText:e=>n("password",e)}),(0,p.jsx)(i.default,{style:O.label,children:"Role"}),(0,p.jsxs)(m.Picker,{selectedValue:t.role,style:O.input,onValueChange:e=>n("role",e),children:[(0,p.jsx)(m.Picker.Item,{label:"--Select Role--",value:""}),(0,p.jsx)(m.Picker.Item,{label:"Student",value:"STUDENT"}),(0,p.jsx)(m.Picker.Item,{label:"Teacher",value:"TEACHER"}),(0,p.jsx)(m.Picker.Item,{label:"Admin",value:"ADMIN"})]}),(0,p.jsx)(u.default,{title:"Register",onPress:async()=>{const{firstName:r,lastName:o,email:n,password:a,role:s}=t;if(r&&o&&n&&a&&s)if(a.length<6)j.default.alert("Error","Password must be at least 6 characters");else try{const t=await fetch("http://192.168.91.1:8085/register",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({firstName:r,lastName:o,email:n,password:a,role:s}).toString()});if(t.ok)j.default.alert("Success","Registration complete",[{text:"Go to Login",onPress:()=>e.reset({index:0,routes:[{name:"Login"}]})}]);else{const e=await t.text();j.default.alert("Error",e||"Registration failed")}}catch(l){console.error(l),j.default.alert("Error","Network error")}else j.default.alert("Error","All fields are required")},color:"#006bae"}),(0,p.jsx)(y.default,{onPress:()=>e.navigate("Login"),children:(0,p.jsx)(i.default,{style:O.loginLink,children:"Already have an account? Login"})})]})]})}const O=f.default.create({container:{backgroundColor:"#f5f5f5"},header:{alignItems:"center",padding:20,backgroundColor:"#006bae"},logo:{height:60,width:120,marginBottom:10},title:{color:"#fff",fontSize:18,fontWeight:"bold"},form:{backgroundColor:"#fff",margin:20,padding:20,borderRadius:10,elevation:2},heading:{fontSize:20,color:"#006bae",textAlign:"center",marginBottom:20,fontWeight:"bold"},label:{fontWeight:"bold",marginTop:10},input:{borderWidth:1,borderColor:"#ccc",borderRadius:5,paddingHorizontal:10,paddingVertical:8,marginTop:5},loginLink:{marginTop:20,color:"#006bae",textAlign:"center",textDecorationLine:"underline"}});var N=r(6725),U=r(2484);const V={Dashboard:120,SurveyDashboard:90,CreateSurvey:150,ViewResponses:60,UsageChart:30},z=()=>{const e=Object.keys(V),t=Object.values(V);return(0,p.jsx)(c.default,{children:(0,p.jsx)(l.default,{children:(0,p.jsx)(U.BarChart,{data:{labels:e,datasets:[{data:t}]},width:N.default.get("window").width-16,height:250,fromZero:!0,yAxisLabel:"",chartConfig:{backgroundGradientFrom:"#ffffff",backgroundGradientTo:"#ffffff",color:(e=1)=>`rgba(0, 107, 174, ${e})`,labelColor:(e=1)=>`rgba(0, 0, 0, ${e})`,barPercentage:.5},style:{marginVertical:20,borderRadius:8}})})})};var F=r(8703);const q=e=>e.reduce(((e,t)=>(e[t.screen]=(e[t.screen]||0)+t.duration,e)),{}),$=e=>JSON.stringify(e,null,2),H=e=>"Screen,Duration (s),Timestamp\n"+e.map((e=>`${e.screen},${e.duration},${e.timestamp}`)).join("\n");function M({route:e,navigation:t,onLogout:r}){const n=e.params?.userId,[a,s]=(0,o.useState)([]),[d,f]=(0,o.useState)({});(0,o.useEffect)((()=>{n&&fetch(`http://192.168.91.1:8085/api/screen-logs/${n}`).then((e=>e.json())).then((e=>{Array.isArray(e)?(s(e),f(q(e))):j.default.alert("Error","Backend returned invalid log format")})).catch((e=>{console.error(e),j.default.alert("Error","Failed to fetch logs from backend")}))}),[n]);return(0,p.jsxs)(c.default,{style:Q.container,children:[(0,p.jsxs)(i.default,{style:Q.title,children:["\ud83d\udcca Screen Usage for User ID: ",n]}),(0,p.jsx)(i.default,{style:Q.subTitle,children:"\u23f1\ufe0f Total Time Per Screen (mins)"}),Object.entries(d).map((([e,t],r)=>(0,p.jsx)(l.default,{style:Q.totalItem,children:(0,p.jsxs)(i.default,{children:[e,": ",(t/60).toFixed(2)," mins"]})},r))),(0,p.jsx)(i.default,{style:Q.subTitle,children:"\ud83d\udccb Detailed Logs"}),a.map(((e,t)=>(0,p.jsxs)(l.default,{style:Q.logItem,children:[(0,p.jsxs)(i.default,{children:["Screen: ",e.screen]}),(0,p.jsxs)(i.default,{children:["Duration: ",e.duration,"s"]}),(0,p.jsxs)(i.default,{children:["Time: ",new Date(e.timestamp).toLocaleString()]})]},t))),(0,p.jsxs)(l.default,{style:Q.buttonRow,children:[(0,p.jsx)(u.default,{title:"\ud83d\udce4 Export as CSV",onPress:async()=>{try{const e=H(a);await F.default.share({message:e})}catch(e){j.default.alert("Error","Failed to share CSV data.")}},color:"#007AFF"}),(0,p.jsx)(u.default,{title:"\ud83d\udce4 Export as JSON",onPress:async()=>{try{const e=$(a);await F.default.share({message:e})}catch(e){j.default.alert("Error","Failed to share JSON data.")}},color:"#34C759"})]}),(0,p.jsx)(l.default,{style:Q.logoutWrapper,children:(0,p.jsx)(u.default,{title:"\ud83d\udeaa Logout",color:"#006bae",onPress:()=>{console.log("\ud83d\udeaa Logout button clicked"),"function"===typeof r?(console.log("\u2705 onLogout function exists \u2014 calling onLogout()"),r()):(console.warn("\u274c onLogout was not passed into ScreenUsageDashboard."),j.default.alert("Error","Logout handler not available."))}})})]})}const Q=f.default.create({container:{padding:16},title:{fontSize:20,fontWeight:"bold",marginBottom:12},subTitle:{fontSize:16,fontWeight:"600",marginTop:16,marginBottom:8},logItem:{padding:10,marginBottom:10,backgroundColor:"#f1f1f1",borderRadius:6},totalItem:{padding:6,borderBottomWidth:1,borderColor:"#ccc"},buttonRow:{flexDirection:"row",justifyContent:"space-around",marginTop:20},logoutWrapper:{marginTop:30,borderTopWidth:1,borderColor:"#ccc",paddingTop:10}});let _="";const G=(e,t)=>{const r=(new Date).toISOString();_=`\ud83d\udcfa User ${t} viewed screen: ${e} at ${r}`,console.log(_),fetch(`http://192.168.91.1:8085/api/screen-logs/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({screenName:e,timestamp:r})}).catch((e=>{console.error("\u274c Failed to log screen usage",e)}))},J=()=>_;function Z(){const[e,t]=(0,o.useState)(J());return(0,o.useEffect)((()=>{const e=setInterval((()=>{t(J())}),1e3);return()=>clearInterval(e)}),[]),(0,p.jsxs)(l.default,{style:K.container,children:[(0,p.jsx)(i.default,{style:K.title,children:"\ud83d\udcca Last Screen Log"}),(0,p.jsx)(i.default,{style:K.logText,children:e||"No screen activity yet."})]})}const K=f.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",padding:20},title:{fontSize:20,marginBottom:20,fontWeight:"bold"},logText:{fontSize:16,color:"#333"}}),X=(0,a.default)(),Y=(0,s.createNavigationContainerRef)();function ee(){const[e,t]=(0,o.useState)(null),r=e?.role?.toLowerCase(),a=e=>{t(e)},s=()=>{console.log("\ud83d\udd10 Logging out..."),t(null),Y.isReady()&&Y.reset({index:0,routes:[{name:"Login"}]})};return(0,p.jsx)(n.default,{ref:Y,onStateChange:t=>{if(e?.id&&t){const r=t.routes[t.index]?.name;G(r,e.id)}},children:(0,p.jsx)(X.Navigator,{initialRouteName:"Login",children:e?"student"===r?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(X.Screen,{name:"Survey",options:{title:"Take Survey"},initialParams:{user:e},children:e=>(0,p.jsx)(x,Object.assign({},e,{onLogout:s}))}),(0,p.jsx)(X.Screen,{name:"SurveyDashboard",options:{title:"My Responses"},initialParams:{user:e},children:e=>(0,p.jsx)(P,Object.assign({},e,{onLogout:s}))}),(0,p.jsx)(X.Screen,{name:"Dashboard",options:{title:"Student Dashboard"},initialParams:{user:e},children:e=>(0,p.jsx)(I,Object.assign({},e,{onLogout:s}))})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(X.Screen,{name:"CreateSurvey",options:{title:"Create Survey"},initialParams:{user:e},children:e=>(0,p.jsx)(S,Object.assign({},e,{onLogout:s}))}),(0,p.jsx)(X.Screen,{name:"SurveyDashboard",options:{title:"Survey Dashboard"},initialParams:{user:e},children:e=>(0,p.jsx)(P,Object.assign({},e,{onLogout:s}))}),(0,p.jsx)(X.Screen,{name:"ViewResponses",options:{title:"View Responses"},initialParams:{user:e},children:e=>(0,p.jsx)(T,Object.assign({},e,{onLogout:s}))}),(0,p.jsx)(X.Screen,{name:"Dashboard",options:{title:"Admin Dashboard"},initialParams:{user:e},children:e=>(0,p.jsx)(I,Object.assign({},e,{onLogout:s}))}),(0,p.jsx)(X.Screen,{name:"UsageChart",initialParams:{user:e},children:e=>(0,p.jsx)(z,Object.assign({},e,{onLogout:s}))}),(0,p.jsx)(X.Screen,{name:"LiveLog",options:{title:"Live Screen Tracker"},initialParams:{user:e},children:e=>(0,p.jsx)(Z,Object.assign({},e,{onLogout:s}))}),(0,p.jsx)(X.Screen,{name:"ScreenUsageDashboard",options:{title:"Screen Usage Dashboard"},initialParams:{user:e},children:e=>(0,p.jsx)(M,Object.assign({},e,{onLogout:s}))})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(X.Screen,{name:"Login",options:{headerShown:!1},children:e=>(0,p.jsx)(E,Object.assign({},e,{onLogin:a}))}),(0,p.jsx)(X.Screen,{name:"Register",component:D,options:{title:"Create Account"}})]})})})}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}r.m=e,(()=>{var e=[];r.O=(t,o,n,a)=>{if(!o){var s=1/0;for(c=0;c<e.length;c++){for(var[o,n,a]=e[c],l=!0,i=0;i<o.length;i++)(!1&a||s>=a)&&Object.keys(r.O).every((e=>r.O[e](o[i])))?o.splice(i--,1):(l=!1,a<s&&(s=a));if(l){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[o,n,a]}})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={792:0};r.O.j=t=>0===e[t];var t=(t,o)=>{var n,a,[s,l,i]=o,d=0;if(s.some((t=>0!==e[t]))){for(n in l)r.o(l,n)&&(r.m[n]=l[n]);if(i)var c=i(r)}for(t&&t(o);d<s.length;d++)a=s[d],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(c)},o=self.webpackChunkweb=self.webpackChunkweb||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=r.O(void 0,[170],(()=>r(5700)));o=r.O(o)})();
//# sourceMappingURL=main.349af8a2.js.map